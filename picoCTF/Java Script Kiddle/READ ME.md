# Java Script Kiddle

Start the challenge, there is a submit box for fill something. Notice that we have some special Java Script code

```js
<script>
			var bytes = [];
			$.get("bytes", function(resp) {
				bytes = Array.from(resp.split(" "), x => Number(x));
			});

			function assemble_png(u_in){
				var LEN = 16;
				var key = "0000000000000000";
				var shifter;
				if(u_in.length == LEN){
					key = u_in;
				}
				var result = [];
				for(var i = 0; i < LEN; i++){
					shifter = key.charCodeAt(i) - 48;
					for(var j = 0; j < (bytes.length / LEN); j ++){
						result[(j * LEN) + i] = bytes[(((j + shifter) * LEN) % bytes.length) + i]
					}
				}
				while(result[result.length-1] == 0){
					result = result.slice(0,result.length-1);
				}
				document.getElementById("Area").src = "data:image/png;base64," + btoa(String.fromCharCode.apply(null, new Uint8Array(result)));
				return false;
			}
</script>
```

After reading the code with the hint of this challenge: "This is only a JavaScript problem". I got something:

We can get the array `bytes` in `https://jupiter.challenges.picoctf.org/problem/17205/bytes`. The function `assemble_png` will make an array `result` with our string number input `shifter`.

`result` is an array bytes of an image. With [https://www.garykessler.net/library/file_sigs.html](https://www.garykessler.net/library/file_sigs.html) I know that an image will start with 8 fixed bytes in hex:

`89 50 4E 47 0D 0A 1A 0A`

But this information do not enough to find 16 characters of `shifter`. I try some commands in Linux to find some special things of image file in hex:

`# hexdump -C Screenshot_2022-01-24_17_14_14.png | head -n 1`

`00000000  89 50 4e 47 0d 0a 1a 0a  00 00 00 0d 49 48 44 52  |.PNG........IHDR|`

Are 16 header bytes of one image in hex fixed and same as  `89 50 4e 47 0d 0a 1a 0a  00 00 00 0d 49 48 44 52`? @Timmy - one of my great teachers in CTF said that: "the first 8 bytes are header signature of png, the next 4 bytes contains length of chuck data, and the next 4 bytes are chunk IHDR".

Although I cann't understand all of his hints, I try to find 16 chareaters of `shifter` with 16 bytes `89 50 4e 47 0d 0a 1a 0a  00 00 00 0d 49 48 44 52` of a PNG file :D

```py
array1 = ['87','130','78','188','0','84','26','157','143','239','249','82','248','212','239','82','195','80','1','207','13','6','1','0','119','243','73','193','78','36','133','108','85','0','0','14','0','186','68','0','0','222','0','243','0','24','174','163','126','0','133','252','137','177','121','10','0','0','0','237','73','63','0','100','96','20','3','224','59','171','16','114','0','0','0','69','0','68','68','147','137','179','110','112','74','121','238','65','1','0','156','0','155','0','95','120','0','233','226','40','78','194','248','44','84','0','208','13','41','72','138','59','164','98','71','0','209','0','99','176','97','120','202','0','135','192','54','101','64','252','81','71','205','10','243','133','30','22','125','237','3','93','90','42','73','221','25','114','243','0','116','22','4','3','59','75','188','119','169','221','161','184','178','2','73','73','231','45','14','99','102','153','166','178','206','54','127','84','240','191','220','10','163','81','64','206','128','132','102','197','72','127','239','253','78','93','8','22','239','207','146','111','143','239','27','243','28','0','173','159','196','48','247','28','84','98','63','52','171','214','214','26','233','254','65','106','111','59','73','255','148','111','103','91','20','206','222','70','252','199','161','124','245','188','102','81','159','119','174','51','190','243','55','243','156','249','124','125','2','143','191','27','119','139','126','88','18','247','171','227','72','66','54','251','0','80','171','146','113','173','4','79','211','216','214','122','119','115','225','45','24','54','44','76','43','253','5','235','104','248','96','8','229','200','75','64','233','217','23','87','40','254','187','107','181','200','181','233','181','81','231','171','165','82','254','196','239','51','43','114','170','73','249','50','114','201','138','64','11','203','155','192','249','226','35','188','156','223','40','217','67','75','100','45','93','102','169','13','34','197','80','175','210','128','137','201','167','45','140','82','171','56','212','17','126','113','139','229','127','223','181','15','0','116','221','186','219','230','56','233','31','15','249','74','119','152','44','41','226','60','35','253','172','97','32','137','233','165','35','181','104','80','217','56','186','205','212','15','64','81','230','230','153','62','251','251','47','151','141','108','32','25','65','11','253','119','201','147','243','11','31','247','233','54','126','217','136','141','191','226','137','213','131','239','100','145','151','150','119','124','159','203','190','63','18','170','210','175','122','223','223','114','124','59','93','245','177','100','15','57','63','239','165','144','13','149','32','198','39','52','53','113','97','91','186','76','91','74','207','133','208','0','245','241','245','73','122','193','223','159','82','175','241','159','231','205','24','92','75','11','247','77','55','170','7','95','127','143','96','207','242','142','153','226','242','93','163','110','185','26','188','4','178','102','159','97','53','58','186','172','239','6','78','215','65','156','90','150','112','205','73','76','149','163','159','242','45','147','16','210','49','254','82','126','200','30','62','190','230','2','86','171','181','197','185','132','170','153','82','191','154','235','147','55','57','92','252','48','207','118','191','170','253','53','127','94','143','122','230','254','154','151','186','55','160','132','126','57','183','217','129','181','95','255','35','223','50','70','77','107','100','203','17','61','163','17','227','147','182','184','79','126','239','28','115','159','254','111','90','250','14','206','185','137','187','141','231','211','241','249','39','99','131','95','210','50','147','241','95','127','103','239','113','165','223','164','245','35','231','132','166','220','241','207','67','178','148','29','156','94','194','74','222','110','0','243','107','158','173','214','210','249','84','66','107','40','0','203','138','164','0','241','9','109','147','207','85','29','204','0']

# 89 50 4e 47 0d 0a 1a 0a  00 00 00 0d 49 48 44 52  (in hex)
# 137 80 78 71 13 10 26 10 0 0 0 13 73 72 68 82   (in decimal)
# head signature
array2 = ['137','80','78','71','13','10','26','10','0','0','0','13','73','72','68','82']

count1 = -1
for i in array2:
    count1 = count1 + 1
    count2 = -1
    for j in array1:
        count2 = count2 + 1
        if (i == j):
            if ((count2 - count1) % 16 == 0 ):
                ans = (count2 - count1) // 16
                if (ans < 10):
                    print(f"index {count1}: {ans}")
```

Luckily, the first 8 charcates and the last 5 chracters of `shifter` fixed. Index 9 can be `2, 3, 4`, index 10 can be `3, 4, 5, 6`, index 11 can be `2, 3, 4`. Therefore I have 36 cases of string number `shifter`

Brute force all these 36 cases, I got the only true string `5108180345363640` that gave me a QR code. Scan this QR code will get the flag of this challenge.
